---
layout: default
title: External Interfaces
group: "navigation"
weight: 6
---

<div id="home">
  <h1>External Interfaces</h1>
  
  <h2>Llama / Tasker / Locale</h2>
  
  <p>Apps like the ones mentioned above allow to execute actions based on external events. Those events may well be the connection to a WLAN, the entering of some area. Those events are pretty useful if combined with an FHEM instance. This is why andFHEM provides an external interface to those apps.</p>
  
  <h3>Sending commands</h3>
  
  <p>AndFHEM provides a UI for sending commands to FHEM. Just look for an andFHEM plugin in your favourite location aware switching app.(AndFHEM 2.1.4+)</p>

  <h3>Triggering actions based on device states</h3>

  <p>You can trigger actions based on device states by adding the Device State Locale Plugin. You need to select a device and enter a desired device state. If the device state is found to match the desired state, the condition is met and an action is triggered. This plugin only works using Locale and Tasker.</p>
  
  <h3>Switching connections</h3>

  <p>Using a Locale Plugin you can switch to another AndFHEM connection. This can be used to select a connection based on an available WLAN connection or a network cell. (AndFHEM 2.7.0+)</p>

  <h3>Receiving device state change broadcasts</h3>

  <p>Tasker allows to receive Intents from external applications and trigger events based on the contents (see <a href="http://tasker.dinglisch.net/userguide/en/intents.html" target="_blank">Tasker Documentation</a> for details, AndFHEM 2.7.0+).</p>

  <p>Broadcasts are only sent if GCM is enabled. The broadcast intents contain the following information:
    <table>
      <tr>
        <td>Broadcast-Aktion</td>
        <td>li.klass.fhem.constants.Actions.EXT_DEVICE_STATE_NOTIFY</td>
      </tr>
      <tr>
        <td>ACTION</td>
        <td>deviceStateChange</td>
      </tr>
      <tr>
        <td>DEVICENAME</td>
        <td>The name of the changed device, i.e. "mat_halogen"</td>
      </tr>
      <tr>
        <td>STATE_NAME</td>
        <td>The name of the changed state. This is always uppercase and usually equals to "STATE".</td>
      </tr>
      <tr>
        <td>STATE_VALUE</td>
        <td>The actual value, i.e. "on".</td>
      </tr>
    </table>
  </p>


  <h2>Programmatic APIs</h2>

  AndFHEM can be partially controlled using intents from external applications:

  <h3>Sending commands</h3>

  <p>Send a command programatically to andFHEM.</p>

  <table>
    <tbody>
    <tr>
      <td>Class Name</td>
      <td>li.klass.fhem.service.intent.SendCommandIntentService</td>
    </tr>
    <tr>
      <td>Action</td>
      <td>li.klass.fhem.constants.Actions.EXECUTE_COMMAND</td>
    </tr>
    <tr>
      <td>Data</td>
      <td>
        Key: COMMAND <br/>
        Value: The command to set (i.e. set abc on)
      </td>
    </tr>
    </tbody>
  </table>

  <h3>Receiving all available device names</h3>

  <p>Receive the device names of all devices available within the current andFHEM connection. (AndFHEM 2.7.0+)</p>

  <table>
    <tbody>
    <tr>
      <td>Class Name</td>
      <td>li.klass.fhem.service.external.ExternalApiService</td>
    </tr>
    <tr>
      <td>Action</td>
      <td>li.klass.fhem.constants.Actions.EXT_DEVICE_NAMES</td>
    </tr>
    <tr>
      <td>Data</td>
      <td>RESULTRECEIVER: An instance of android.os.ResultReceiver, whose #onReceiveResult method will be called.</td>
    </tr>
    <tr>
      <td>Response Data</td>
      <td>DEVICENAMES: ArrayList&lt;String&gt;, that contains information about device names. Each entry contains three values: device name, alias and widget name. The values are separated using a pipe (|) character. If a value is unset, the value is empty. <br/> Some examples: <br/> mat_halogen|halogenlampe|hal <br/> mat_halogen||</td>
    </tr>
    <tr> 
      <td>Example code</td>
      <td>
        <div class="code">
{% highlight java %}
Intent intent = new Intent("li.klass.fhem.constants.Actions.EXT_DEVICE_NAMES");
intent.putExtra("RESULTRECEIVER", new ResultReceiver(new Handler()) {
  @Override
  protected void onReceiveResult(int resultCode, Bundle resultData) {
    super.onReceiveResult(resultCode, resultData);
    ArrayList<String> list = resultData.getStringArrayList("DEVICENAMES");
    for (String s : list) {
      Log.e(TAG, s);
    }
  }
});
{% endhighlight %}
        </div>
      </td>
    </tbody>
  </table>


</div>
